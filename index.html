<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Привет, Звёздочка</title>
  <style>
    /* Минимальный стиль, ориентирован на iPhone / Safari */
    :root{--safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom)}
    html,body{height:100%;margin:0;-webkit-text-size-adjust:100%; background:#001436;color:#fff;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial}

    /* слой фона со звёздочками */
    .bg-layer{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}

    .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:calc(16px + var(--safe-top)) 20px calc(20px + var(--safe-bottom));box-sizing:border-box;text-align:center;position:relative;z-index:1}
    .card{max-width:720px;width:100%}
    .message{font-size:28px;line-height:1.2;margin:0 0 20px;word-break:break-word;opacity:1;transition:opacity .35s ease;}
    @media (max-width:420px){.message{font-size:32px}}
    button{appearance:none;border:0;padding:12px 20px;border-radius:10px;font-size:18px;background:#f2f2f2;color:#000;cursor:pointer}
    button:active{transform:translateY(1px)}
    button[disabled]{opacity:.5;cursor:default}
    .fade-out{opacity:0}

    /* confetti canvas sits above content but doesn't catch pointer events */
    canvas.confetti-canvas{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:9999}

    /* Стили для SVG звёзд */
    .star-svg{position:absolute;left:0;top:0;width:auto;height:auto;transform-origin:center center;pointer-events:none}

    /* анимация плавания звезды и исчезновения */
    @keyframes floatStar {
      0% { transform: translateY(0px) rotate(0deg) scale(0.9); opacity:0; }
      6% { opacity:1 }
      50% { transform: translateY(-40px) rotate(180deg) scale(1); }
      100% { transform: translateY(-160px) rotate(360deg) scale(0.7); opacity:0; }
    }

    /* Модал для ввода пароля */
    .pw-modal {
      position:fixed;
      inset:0;
      background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.75));
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:50;
      padding:20px;
    }
    .pw-box{
      width:100%;
      max-width:420px;
      background:linear-gradient(180deg,#02102a,#001432);
      border-radius:14px;
      padding:20px;
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
      text-align:center;
      color:#fff;
    }
    .pw-box h3{margin:0 0 10px;font-size:20px}
    .pw-input{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.08);
      background:rgba(255,255,255,0.03);
      color:#fff;
      font-size:16px;
      margin-bottom:12px;
      box-sizing:border-box;
    }
    .pw-actions{display:flex;gap:10px;justify-content:center}
    .pw-hint{font-size:13px;color:rgba(255,255,255,0.65);margin-top:10px}

    /* анимация ошибки */
    @keyframes shake {
      0% { transform: translateX(0) }
      20% { transform: translateX(-8px) }
      40% { transform: translateX(8px) }
      60% { transform: translateX(-6px) }
      80% { transform: translateX(6px) }
      100% { transform: translateX(0) }
    }
    .shake { animation: shake .5s ease; }

  </style>
</head>
<body>
  <!-- фон для звёзд -->
  <div class="bg-layer" id="bgLayer" aria-hidden="true"></div>

  <div class="wrap">
    <div class="card">
      <p id="msg" class="message">Привет, Звёздочка!!</p>
      <div style="display:flex;justify-content:center;gap:12px">
        <button id="nextBtn" aria-label="Далее" disabled>Далее</button>
        <button id="confettiBtn" style="display:none">Повторить конфетти</button>
      </div>
    </div>
  </div>

  <!-- Модал ввода пароля -->
  <div id="pwModal" class="pw-modal" aria-hidden="false" role="dialog" aria-label="Требуется пароль">
    <div class="pw-box" role="document">
      <h3>Введите пароль, чтобы продолжить</h3>
      <input id="pwInput" class="pw-input" type="password" placeholder="Пароль" aria-label="Пароль" />
      <div class="pw-actions">
        <button id="pwOkBtn">Войти</button>
        <button id="pwCancelBtn">Отмена</button>
      </div>
      <div class="pw-hint">Если у вас есть пароль — введите его. Подсказка: обратитесь к отправителю.</div>
    </div>
  </div>

  <script>
    (function(){
      const CORRECT = 'evawithoutadam'; // правильный пароль (как вы просили)
      const messages = [
        "Привет, Звёздочка!!",
        "Мрррмяу я люблю тебя",
        "Прости, я так и не взял себя в руки и не смог закончить ту игру, которую я делал для тебя на день рождения :c",
        "...Теперь я закончу ее когда-нибудь, когда ты не будешь ждать этого",
        "Вхихих",
        "Спасибо большое что ты так долго живешь на этом свете",
        "Ты",
        "очаровательная",
        "нежная",
        "старательная",
        "любящая",
        "упорная",
        "искренняя",
        "самая честная!!!!",
        "И многгоо много всяких хороших прилагательных",
        "Я до сих пор не верю в то, что нашел человека без минусов, а если минусы и есть, то они.. Субъективны, да и для меня минусами не являются",
        "Вихиххих",
        "Спасибо тебе за все что ты сделала, mon amour Astérisque",
        "И не только для меня!",
        "Ты великая награда всему миру за долгиеее годыы страдания и войн",
        "Никогда не обесценивай себя",
        "Ты самое ценное, что есть у этого мира",
        "и у меня",
        "Теперь ты уже совсем тётя!!!",
        "Ты можешь...Грабить банки и седлать инопланетянинов?",
        "Или просто не волноваться по поводу того что ты взрослая и двигаться дальше",
        "В любом случае я всегда буду рядом :)",
        "так что не переживай, моя милая Тигровая Лилия",
        "*стикер с милым мальчиком-зайчиком в шапочке и тильняшке который тебя очень сильно любит*",
        "С ДНЕМ РОЖДЕНИЯЯЯЯ, ЗВЁЗДОЧКАА!!!!!!"
      ];

      let idx = 0;
      const msgEl = document.getElementById('msg');
      const btn = document.getElementById('nextBtn');
      const bgLayer = document.getElementById('bgLayer');
      const confettiBtn = document.getElementById('confettiBtn');

      let finaleTriggered = false;
      let audioContext;

      // --- Password modal elements ---
      const pwModal = document.getElementById('pwModal');
      const pwInput = document.getElementById('pwInput');
      const pwOkBtn = document.getElementById('pwOkBtn');
      const pwCancelBtn = document.getElementById('pwCancelBtn');

      // Проверим, был ли уже введён пароль в этой сессии
      const unlocked = sessionStorage.getItem('unlocked') === '1';
      if (unlocked) {
        hideModal();
        enableControls();
      } else {
        showModal();
        disableControls();
      }

      function showModal(){
        pwModal.style.display = 'flex';
        pwModal.setAttribute('aria-hidden','false');
        // помещаем фокус в input
        setTimeout(()=> pwInput.focus(), 120);
      }
      function hideModal(){
        pwModal.style.display = 'none';
        pwModal.setAttribute('aria-hidden','true');
      }
      function disableControls(){
        btn.disabled = true;
        // предотвращаем переход по клику на сообщение
        msgEl.style.cursor = 'default';
      }
      function enableControls(){
        btn.disabled = false;
        msgEl.style.cursor = 'pointer';
      }

      function checkPassword(value){
        try {
          // простой строгий сопоставитель
          return value === CORRECT;
        } catch (e) {
          return false;
        }
      }

      pwOkBtn.addEventListener('click', ()=>{
        const val = pwInput.value || '';
        if (checkPassword(val)) {
          sessionStorage.setItem('unlocked','1');
          hideModal();
          enableControls();
        } else {
          // короткая визуальная ошибка
          pwInput.classList.remove('shake');
          // force reflow to restart animation
          void pwInput.offsetWidth;
          pwInput.classList.add('shake');
          pwInput.value = '';
          pwInput.focus();
        }
      });

      // Allow Enter key to submit
      pwInput.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter') {
          pwOkBtn.click();
        }
      });

      // Cancel hides modal but keeps locked (user can reopen by refresh)
      pwCancelBtn.addEventListener('click', ()=>{
        // просто скрываем модал, но не даём продвигаться дальше
        hideModal();
        // оставляем интерфейс заблокированным; покажем краткое сообщение
        msgEl.textContent = "Чтобы начать — нужно ввести пароль.";
        disableControls();
        // потом снова показать модал, если пользователь кликнет по сообщению
        msgEl.addEventListener('click', showModalOnce, { once: true });
      });

      function showModalOnce(){ showModal(); }

      // --- Существующая логика показа сообщений (малые правки: учитываем блокировку) ---
      function show(index){
        msgEl.classList.add('fade-out');
        setTimeout(()=>{
          msgEl.textContent = messages[index] || '';
          msgEl.classList.remove('fade-out');

          // добавляем одну звёздочку на каждый показ сообщения
          addStarForIndex(index);

          // Запускаем звук и конфетти, если это последнее сообщение
          if(index >= messages.length - 1){
              if (!finaleTriggered) {
                finaleTriggered = true;
                playHorn();
                launchConfetti();
              }
              confettiBtn.style.display = 'inline-block';
          }
        }, 220);

        // если последний — отключаем кнопку
        if(index >= messages.length - 1){
          btn.textContent = 'Завершено';
          btn.disabled = true;
        } else {
          btn.textContent = 'Далее';
          btn.disabled = false;
        }
      }

      btn.addEventListener('click', ()=>{
          // Дополнительная защита: если ещё не разблокировано — откроем модал
          if (sessionStorage.getItem('unlocked') !== '1') {
            showModal();
            return;
          }

          if (!audioContext) { // Инициализируем audioContext при первом клике
              const AudioContext = window.AudioContext || window.webkitAudioContext;
              audioContext = new AudioContext();
          }

          if(idx < messages.length - 1){
              idx++;
              show(idx);
          } else {
              idx = messages.length - 1;
              show(idx);
          }
      });

      msgEl.addEventListener('click', ()=>{
        // клик по сообщению должен работать как клик по кнопке, но только если разблокировано
        if (sessionStorage.getItem('unlocked') === '1') {
          btn.click();
        } else {
          showModal();
        }
      });

      // Показываем первый элемент корректно
      show(0);

      // --- Добавление звёздочки (SVG) ---
      function addStarForIndex(i){
        const star = createStarShape();
        const padding = 0.06;
        const left = Math.random() * (1 - padding*2) + padding;
        const top = 0.2 + Math.random() * 0.55;
        const baseSize = Math.max(18, Math.min(62, Math.round(window.innerWidth * (0.06 + Math.random()*0.07))));
        star.style.left = Math.round(left * 100) + '%';
        star.style.top = Math.round(top * 100) + '%';
        star.style.width = baseSize + 'px';
        star.style.height = baseSize + 'px';
        const dur = (6 + Math.random() * 4).toFixed(2) + 's';
        star.style.animation = `floatStar ${dur} cubic-bezier(.2,.8,.2,1)`;
        bgLayer.appendChild(star);
        star.addEventListener('animationend', ()=>{
          if(star && star.parentNode) star.parentNode.removeChild(star);
        }, {once:true});
      }

      function createStarShape(){
        const svgNS = 'http://www.w3.org/2000/svg';
        const svg = document.createElementNS(svgNS, 'svg');
        svg.setAttribute('viewBox','0 0 100 100');
        svg.setAttribute('class','star-svg');
        svg.setAttribute('aria-hidden','true');
        const path = document.createElementNS(svgNS, 'path');
        path.setAttribute('d', 'M50 3 L61.8 35.3 L95.1 35.3 L68.6 54.7 L79.9 87.0 L50 67.5 L20.1 87.0 L31.4 54.7 L4.9 35.3 L38.2 35.3 Z');
        const palette = ['#FFF26A','#FFD36E','#FF9CCF','#B6E9FF','#FFD7A1','#E6FFB3','#FFC6F9'];
        path.setAttribute('fill', palette[Math.floor(Math.random()*palette.length)]);
        path.setAttribute('fill-opacity', '0.95');
        path.setAttribute('stroke','rgba(0,0,0,0.06)');
        path.setAttribute('stroke-width','1');
        svg.appendChild(path);
        const wrapper = document.createElement('div');
        wrapper.style.position = 'absolute';
        wrapper.style.pointerEvents = 'none';
        wrapper.style.transform = 'translate(-50%, -50%)';
        wrapper.style.willChange = 'transform, opacity';
        wrapper.className = 'star-wrapper';
        wrapper.appendChild(svg);
        svg.style.width = '100%';
        svg.style.height = '100%';
        svg.style.display = 'block';
        return wrapper;
      }

      // --- Звук дудки / гудка через WebAudio ---
      function playHorn(){
        try{
          const AudioContext = window.AudioContext || window.webkitAudioContext;
          if (typeof AudioContext === 'undefined') {
              console.warn('Web Audio API is not supported in this browser.');
              return;
          }
          const ac = audioContext;
          const now = ac.currentTime;
          const osc1 = ac.createOscillator();
          osc1.type = 'sawtooth';
          osc1.frequency.setValueAtTime(1200, now);
          osc1.frequency.exponentialRampToValueAtTime(220, now + 1.6);
          const osc2 = ac.createOscillator();
          osc2.type = 'sine';
          osc2.frequency.setValueAtTime(440, now);
          osc2.detune.setValueAtTime(0, now);
          const gain = ac.createGain();
          gain.gain.setValueAtTime(0.0001, now);
          gain.gain.exponentialRampToValueAtTime(0.8, now + 0.04);
          gain.gain.setValueAtTime(0.8, now + 0.18);
          gain.gain.exponentialRampToValueAtTime(0.0001, now + 2.6);
          const mix = ac.createGain();
          const osc2Gain = ac.createGain();
          osc2Gain.gain.setValueAtTime(0.35, now);
          osc1.connect(mix);
          osc2.connect(osc2Gain);
          osc2Gain.connect(mix);
          mix.connect(gain);
          gain.connect(ac.destination);
          osc1.start(now);
          osc2.start(now);
          osc1.stop(now + 2.7);
          osc2.stop(now + 2.7);
        }catch(e){
          console.warn('Audio failed:', e);
        }
      }

      // --- Конфетти на canvas ---
      function launchConfetti(){
        if(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        const canvas = document.createElement('canvas');
        if (!canvas.getContext) {
              console.warn('Canvas API is not supported in this browser.');
              return;
        }
        canvas.className = 'confetti-canvas';
        canvas.style.width = '100%';
        canvas.style.height = '100%';
        document.body.appendChild(canvas);
        const ctx = canvas.getContext('2d');
        let w = canvas.width = innerWidth * devicePixelRatio;
        let h = canvas.height = innerHeight * devicePixelRatio;
        canvas.style.width = innerWidth + 'px';
        canvas.style.height = innerHeight + 'px';
        ctx.scale(devicePixelRatio, devicePixelRatio);
        const colors = ['#ff4d6d','#ffb86b','#ffd166','#8ce99a','#66c2ff','#c084fc','#ff63b6'];
        const particles = [];
        const count = Math.floor(Math.max(24, innerWidth / 15));
        for(let i=0;i<count;i++){
          particles.push(createParticle());
        }
        let rafId;
        const gravity = 0.25;
        function createParticle(){
          const size = rand(6, 14);
          return {
            x: rand(0, innerWidth),
            y: rand(-20, innerHeight/2),
            vx: rand(-5,5),
            vy: rand(-10, 5),
            size,
            rot: rand(0,360),
            vr: rand(-8,8),
            color: colors[Math.floor(Math.random()*colors.length)],
            ttl: rand(180, 320)
          };
        }
        function rand(min,max){ return Math.random()*(max-min)+min }
        function draw(){
          ctx.clearRect(0,0,innerWidth,innerHeight);
          for(let i=particles.length-1;i>=0;i--){
            const p = particles[i];
            p.vy += gravity * 0.6;
            p.x += p.vx;
            p.y += p.vy;
            p.rot += p.vr;
            p.ttl--;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot * Math.PI / 180);
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size * 0.6);
            ctx.restore();
            if(p.y > innerHeight + 50 || p.x < -50 || p.x > innerWidth + 50 || p.ttl <= 0){
              particles.splice(i,1);
            }
          }
          if(particles.length === 0){
            cancelAnimationFrame(rafId);
            setTimeout(()=>{ if(canvas && canvas.parentNode) canvas.parentNode.removeChild(canvas); }, 500);
            return;
          }
          rafId = requestAnimationFrame(draw);
        }
        draw();
        function onResize(){
          w = canvas.width = innerWidth * devicePixelRatio;
          h = canvas.height = innerHeight * devicePixelRatio;
          canvas.style.width = innerWidth + 'px';
          canvas.style.height = innerHeight + 'px';
          ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
        }
        window.addEventListener('resize', onResize);
        window.addEventListener('orientationchange', onResize);
        setTimeout(()=>{ particles.length = 0; }, 10000);
      }

      confettiBtn.addEventListener('click', ()=>{
        launchConfetti();
        if (!audioContext) {
          const AudioContext = window.AudioContext || window.webkitAudioContext;
          audioContext = new AudioContext();
        }
        playHorn();
      });

    })();
  </script>
</body>
</html>
